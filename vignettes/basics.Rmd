---
title: "Basics"
author: "Steffen Ehrmann"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
  rmarkdown::html_document:
    toc: true
    toc_float: true
    theme: spacelab
link-citations: yes
vignette: >
  %\VignetteIndexEntry{Basics}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(rasterTools)
library(raster)
library(magrittr)
continuous <- rtData$continuous
categorial <- rtData$categorial
catPatchesObj <- rSubstitute(obj = categorial, 
                             old = sort(base::unique(raster::values(categorial))),
                             new = c(1, 2, 3, 4, 3, 4, 5, 5, 5))
binarised <- rBinarise(categorial, match = c(41, 44, 47))
```

This document outlines basic operations that either stand on their own or may be necessary as basis for other operations. If you did not come from the page [Usecases](/rastertools/articles/usecases.html), you should go there now to read in the required objects.

# Compute the distance map of centroids per patch
We may be interested in distance maps to calculate a range of landscape metrics. For example, the *Radius of Gyration* derives from the average distance of all cells of a patch to the patches' centroid. To calculate it, we would have to find the patch centroid and the patch specific distance of each cell of a patch to its centroid.

```{r, fig.width=7, out.width='100%'}
centDistMap <- list(dis = list(operator = "rCentroid", background = 0),
                    dis = list(operator = "rBinarise", thresh = 1),
                    dis = list(operator = "rDistance"),
                    dis = list(operator = "rOffset"),
                    dis = list(operator = "rMask", mask = "input"),
                    dis = list(operator = "rFillNA"))

DistMap <- modify(input = binarised, by = centDistMap)
visualise(DistMap)
```

We see, however, that the distances of some centroids overlap with patches to which they do not belong. Hence, we have to segregate the raster into its patches.

```{r, fig.width=7, out.width='100%'}
getCentDist <- list(patchesMask = list(operator = "rSegregate"),
                    patchesMask = list(operator = "rFillNA"),
                    distances = list(operator = "rSegregate"),
                    distances = list(operator = "rFillNA"),
                    distances = list(operator = "rCentroid", background = 0),
                    distances = list(operator = "rDistance"),
                    distances = list(operator = "rOffset"),
                    distances = list(operator = "rMask", mask = "patchesMask"),
                    distances = list(operator = "rFillNA"),
                    distances = list(operator = "rReduce", fun = max))

patchObj <- rPatches(binarised)
centDistMap <- modify(input = patchObj, by = getCentDist, keepInput = TRUE)
centDistMap <- raster::stack(centDistMap[c(1, 3)])
visualise(centDistMap)
```

See [link to radius of gyration metric] for how to proceed from here to calculate the *Radius of Gyration*.
